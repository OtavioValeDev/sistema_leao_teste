<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Cliente M√≠nimo</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .product-card { border: 1px solid #ccc; padding: 10px; margin: 10px; border-radius: 5px; }
        .loading { color: blue; }
        .error { color: red; }
        button { padding: 10px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Teste M√≠nimo - Cliente</h1>

    <button onclick="testAPI()">Testar API</button>
    <button onclick="loadProducts()">Carregar Produtos</button>
    <button onclick="clearLogs()">Limpar Logs</button>

    <div id="status"></div>
    <div id="products"></div>

    <script>
        const API_BASE = window.location.protocol + '//' + window.location.host + '/api/products';

        function log(message) {
            const status = document.getElementById('status');
            const div = document.createElement('div');
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            status.appendChild(div);
            console.log(message);
        }

        async function testAPI() {
            log('üîç Testando conex√£o com API...');
            try {
                const response = await fetch(API_BASE + '/debug');
                if (response.ok) {
                    const text = await response.text();
                    log('‚úÖ API OK: ' + text.substring(0, 100) + '...');
                } else {
                    log('‚ùå API Error: ' + response.status);
                }
            } catch (error) {
                log('‚ùå API Error: ' + error.message);
            }
        }

        async function loadProducts() {
            log('üîÑ Carregando produtos...');
            const productsDiv = document.getElementById('products');
            productsDiv.innerHTML = '<div class="loading">Carregando...</div>';

            try {
                // Try main endpoint first
                log('üì§ Tentando endpoint principal...');
                let response = await fetch(API_BASE);
                log('üì° Resposta principal: ' + response.status + ' ' + response.statusText);

                // If main fails, try cors-test endpoint
                if (!response.ok) {
                    log('üîÑ Tentando endpoint cors-test...');
                    response = await fetch(API_BASE + '/cors-test');
                    log('üì° Resposta cors-test: ' + response.status + ' ' + response.statusText);
                }

                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }

                const products = await response.json();
                log('‚úÖ Recebidos ' + products.length + ' produtos');

                let html = '';
                products.forEach(product => {
                    html += `
                        <div class="product-card">
                            <h3>${product.name}</h3>
                            <p>R$ ${(product.priceInCents / 100).toFixed(2)}</p>
                            <button onclick="addToCart(${product.id})">Adicionar</button>
                        </div>
                    `;
                });

                productsDiv.innerHTML = html;
                log('‚úÖ Produtos renderizados');

            } catch (error) {
                log('‚ùå Erro: ' + error.message);
                productsDiv.innerHTML = '<div class="error">Erro ao carregar produtos: ' + error.message + '</div>';
            }
        }

        function addToCart(productId) {
            log('üõí Adicionado produto ' + productId + ' ao carrinho');
        }

        function clearLogs() {
            document.getElementById('status').innerHTML = '';
        }

        // Auto test on load
        window.onload = function() {
            log('üöÄ P√°gina carregada');
            setTimeout(() => {
                testAPI();
            }, 1000);
        };
    </script>
</body>
</html>
