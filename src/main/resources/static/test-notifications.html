<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Notifica√ß√µes</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #results { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üß™ Painel de Diagn√≥stico - Sistema de Pedidos</h1>

    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h3>üìä Status da API</h3>
        <button onclick="testAPIConnection()">Testar Conex√£o com API</button>
        <button onclick="testLoadProducts()">Carregar Produtos</button>
        <button onclick="testCreateProduct()">Criar Produto de Teste</button>
    </div>

    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <h3>üîî Sistema de Notifica√ß√µes</h3>
        <button onclick="testCreateNotification()">Criar Notifica√ß√£o (Cliente)</button>
        <button onclick="testGetNotifications()">Ver Notifica√ß√µes (Funcion√°rio)</button>
    </div>

    <button onclick="clearResults()">Limpar Resultados</button>

    <div id="results"></div>

    <script>
        const API_BASE = window.location.protocol + '//' + window.location.host + '/api/products';

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        async function testAPIConnection() {
            try {
                log('Testando conex√£o com a API...');
                const response = await fetch(API_BASE + '/debug');

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const result = await response.text();
                log(`‚úÖ API conectada! Resposta: ${result.substring(0, 200)}...`, 'success');
            } catch (error) {
                log(`‚ùå Erro na conex√£o com API: ${error.message}`, 'error');
            }
        }

        async function testLoadProducts() {
            try {
                log('Carregando produtos da API...');
                const response = await fetch(API_BASE);

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const products = await response.json();
                log(`‚úÖ ${products.length} produtos carregados:`, 'success');
                products.forEach(product => {
                    log(`  - ${product.name}: R$ ${(product.priceInCents / 100).toFixed(2)}`);
                });
            } catch (error) {
                log(`‚ùå Erro ao carregar produtos: ${error.message}`, 'error');
            }
        }

        async function testCreateProduct() {
            const testProduct = {
                name: `Produto Teste ${Date.now()}`,
                priceInCents: Math.floor(Math.random() * 1000) + 500
            };

            try {
                log(`Criando produto de teste: ${testProduct.name}...`);
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testProduct)
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const result = await response.json();
                log(`‚úÖ Produto criado: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`‚ùå Erro ao criar produto: ${error.message}`, 'error');
            }
        }

        async function testCreateNotification() {
            try {
                log('Enviando solicita√ß√£o de atendimento preferencial...');
                const response = await fetch(API_BASE + '/notificacao-preferencial', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const result = await response.json();
                log(`‚úÖ Notifica√ß√£o criada: ${JSON.stringify(result)}`, 'success');
            } catch (error) {
                log(`‚ùå Erro ao criar notifica√ß√£o: ${error.message}`, 'error');
            }
        }

        async function testGetNotifications() {
            try {
                log('Carregando notifica√ß√µes pendentes...');
                const response = await fetch(API_BASE + '/notificacoes-pendentes');

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const notifications = await response.json();
                log(`üìã Notifica√ß√µes encontradas: ${notifications.length}`, 'success');

                notifications.forEach(notification => {
                    log(`ID: ${notification.id}, Mensagem: ${notification.message}, Status: ${notification.status}`);
                });
            } catch (error) {
                log(`‚ùå Erro ao carregar notifica√ß√µes: ${error.message}`, 'error');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Teste autom√°tico ao carregar a p√°gina
        window.onload = function() {
            log('P√°gina de teste carregada. Use os bot√µes para testar as funcionalidades.');
        };
    </script>
</body>
</html>
